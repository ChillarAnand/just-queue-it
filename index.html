<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>celery</title>
<meta name="author" content="(Anand Pandikunta)"/>

<link rel="stylesheet" href="http://cdn.jsdelivr.net/reveal.js/2.5.0/css/reveal.min.css"/>
<link rel="stylesheet" href="http://cdn.jsdelivr.net/reveal.js/2.5.0/css/theme/simple.css" id="theme"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'http://cdn.jsdelivr.net/reveal.js/2.5.0/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<div class="reveal">
  <div class='footer'>
      <span>Anand Reddy Pandikunta (@chillaranand)</span>
      <a href="http://www.avilpage.com">http://avilpage.com</a>
  </div>

<div class="slides">


<section>
<section id="sec-1" >

<h2>Just Queue It!</h2>
<p>
Queue Everything &amp; Delight Everyone.
</p>
</section>


</section>
<section>
<section id="sec-2" >

<h2>About This Talk.</h2>
<p>
Why Celery?
</p>

<p>
How Celery Works?
</p>

<p>
Running Tasks.
</p>

<p>
Canvas Workflow.
</p>

<p>
Monitoring Celery.
</p>
</section>


</section>
<section>
<section id="sec-3" >

<h2>Why Celery?</h2>
<ul class="org-ul"><li class="fragment none">Running Tasks In Background.<br/></li>
<li class="fragment none">Automatic Retrying Failed Tasks.<br/></li>
<li class="fragment none">Multi Processing.<br/></li>
<li class="fragment none">Scheduling Periodic Work.<br/></li></ul>
</section>


</section>
<section>
<section id="sec-4" >

<h2>What Is Celery?</h2>
<ul class="org-ul"><li class="fragment none">Itâ€™s a task queue with focus on real-time processing, while also supporting task scheduling.<br/></li>

<li class="fragment none">Task queues are used as a mechanism to distribute work across threads or machines.<br/></li></ul>
</section>



</section>
<section>
<section id="sec-5" >

<h2>How Celery Works?</h2>
</section>

</section>
<section>
<section id="sec-6" >

<h2>A Simple Queue</h2>
<img src="queue.png" alt="queue.png" />
</section>

</section>
<section>
<section id="sec-7" >

<h2>A Simple Python Process</h2>
<img src="python.png" alt="python.png" />
</section>


</section>
<section>
<section id="sec-8" >

<h2>Token Based Queue System</h2>
<img src="bank.png" alt="bank.png" />
</section>


</section>
<section>
<section id="sec-9" >

<h2>Running a task with celery</h2>
<img src="celery.png" alt="celery.png" />
</section>

</section>
<section>
<section id="sec-10" >

<h2>Getting Started</h2>
<p>
Install Celery
</p>

<p>
Pick a broker &amp; install it.
</p>

<p>
Add tasks &amp; start processing them.
</p>
</section>



</section>
<section>
<section id="sec-11" >

<h2>Supported Brokers</h2>
<img src="./brokers.png" alt="brokers.png" />
</section>



</section>
<section>
<section id="sec-12" >

<h2>Which Broker?</h2>
<p>
Low volume tasks - Any broker.
</p>

<p>
High volume tasks - RabbitMQ or Redis.
</p>
</section>


</section>
<section>
<section id="sec-13" >

<h2>RabbitMQ</h2>
<p>
(Designed for messaging)
</p>

<p>
Advanced Routing.
</p>

<p>
Reliable delivery through acknowledgement.
</p>

<p>
Can push &gt; 100k messages per second.
</p>
</section>


</section>
<section>
<section id="sec-14" >

<h2>Redis</h2>
<p>
(In memory data store)
</p>

<p>
Lightweight.
</p>

<p>
Blazing fast.
</p>
</section>


</section>
<section>
<section id="sec-15" >

<h2>Tasks</h2>
<div class="org-src-container">

<pre  class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">task.py</span>
<span style="color: #a020f0;">from</span> celery <span style="color: #a020f0;">import</span> Celery

<span style="color: #a0522d;">app</span> = Celery(<span style="color: #8b2252;">'tasks'</span>, backend=<span style="color: #8b2252;">'amqp'</span>,
<span style="background-color: #f2f2f2;"> </span>   <span style="background-color: #f2f2f2;"> </span>   <span style="background-color: #f2f2f2;"> </span>    broker=<span style="color: #8b2252;">'amqp://guest@localhost//'</span>)


<span style="color: #228b22;">@app.task</span>()
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
<span style="background-color: #f2f2f2;"> </span>   <span style="color: #a020f0;">return</span> x + y
</pre>
</div>

<div class="org-src-container">

<pre  class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">add tasks into queue</span>

<span style="color: #a0522d;">result</span> = add.apply_async(args=[3, 4])  <span style="color: #b22222;"># </span><span style="color: #b22222;">or</span>

<span style="color: #a0522d;">result</span> = add.delay(3, 4)
</pre>
</div>

<div class="org-src-container">

<pre  class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">check result</span>
result.ready()  <span style="color: #b22222;"># </span><span style="color: #b22222;">result.status</span>
result.get()
</pre>
</div>
</section>


</section>
<section>
<section id="sec-16" >

<h2>Workers</h2>
<div class="org-src-container">

<pre  class="src src-sh">celery worker --help  <span style="color: #b22222;"># </span><span style="color: #b22222;">all options</span>

celery worker -A task -l info -n foo_worker

celery worker -A task -c 8 --logfile=foo.log

celery worker -l info -A task -Q vip
</pre>
</div>

<div class="org-src-container">

<pre  class="src src-sh">celery inspect active

celery inspect active_queues
</pre>
</div>
</section>



</section>
<section>
<section id="sec-17" >

<h2>Canvas Workflow</h2>
<div class="org-src-container">

<pre  class="src src-python">add.s(2, 3)  <span style="color: #b22222;"># </span><span style="color: #b22222;">subtask - signature object</span>

add.si(2, 3)  <span style="color: #b22222;"># </span><span style="color: #b22222;">immutable signature object</span>

<span style="color: #a0522d;">result</span> = chain(add.s(2, 2), add.s(4))()  <span style="color: #b22222;"># </span><span style="color: #b22222;">chain</span>

<span style="color: #a0522d;">result</span> = group(add.s(i, i) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(10))()  <span style="color: #b22222;"># </span><span style="color: #b22222;">group</span>

<span style="color: #a0522d;">result</span> = chord((add.s(i, i) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">xrange</span>(10)), xsum.s())()  <span style="color: #b22222;"># </span><span style="color: #b22222;">chord</span>
</pre>
</div>
</section>


</section>
<section>
<section id="sec-18" >

<h2>Routing</h2>
<div class="org-src-container">

<pre  class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">run multiple tasks</span>

add.apply_async([1, 2], queue=<span style="color: #8b2252;">'add_queue'</span>)

sub.apply_async([3, 4], queue=<span style="color: #8b2252;">'sub_queue'</span>)
</pre>
</div>

<div class="org-src-container">

<pre  class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">run multiple workers</span>

celery worker -l info -A tasks -Q add_queue

celery worker -l info -A tasks -Q sub_queue
</pre>
</div>
</section>


</section>
<section>
<section id="sec-19" >

<h2>Monitoring.</h2>
<p>
Flower: Real-time monitor &amp; web admin for Celery.
</p>
</section>


</section>
<section>
<section id="sec-20" >

<h2>Web hooks</h2>
<p>
Integrating with other languages/frameworks
</p>

<p>
Call a task using GET/POST request &amp; retrieve result.
</p>

<div class="org-src-container">

<pre  class="src src-sh">curl -X POST http://localhost:5555/api/task/async-apply/my_app.test_task
</pre>
</div>
</section>



</section>
<section>

<section id="sec-21" >

<h2>Where To Go From Here?</h2>
<p>
References:

<a href="http://celery.readthedocs.org/">Celery Docs</a>,
<a href="http://nbviewer.ipython.org/github/mher/flower/blob/master/docs/api.ipynb">FLower REST API</a>
</p>

<p>
Articles:

    <a href="https://denibertovic.com/posts/celery-best-practices/">Best Practices</a>,
    <a href="http://wiredcraft.com/blog/3-gotchas-for-celery/">Gotchas for Celery</a>
</p>

<p>
Talks:

<a href="http://pyvideo.org/video/2843/painting-on-a-distributed-canvas-an-advanced-gui">Distributed Canvas Workflow</a>
</p>
</section>

</section>
<section>
<section id="sec-22" >

<h2>Questions?</h2>
</section>
</section>
</div>
</div>

<script src="http://cdn.jsdelivr.net/reveal.js/2.5.0/lib/js/head.min.js"></script>
<script src="http://cdn.jsdelivr.net/reveal.js/2.5.0/js/reveal.min.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: true,
rollingLinks: false,
keyboard: true,
overview: true,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'linear', // default/cube/page/concave/zoom/linear/fade/none
transitionSpeed: 'default',

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: 'http://cdn.jsdelivr.net/reveal.js/2.5.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
 { src: 'http://cdn.jsdelivr.net/reveal.js/2.5.0/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'http://cdn.jsdelivr.net/reveal.js/2.5.0/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'http://cdn.jsdelivr.net/reveal.js/2.5.0/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
 { src: 'http://cdn.jsdelivr.net/reveal.js/2.5.0/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'http://cdn.jsdelivr.net/reveal.js/2.5.0/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
]
});
</script>


<style>
.reveal .footer {
  position: absolute;
  bottom: 1em;
  left: 1em;
  font-size: 0.5em;
}
</style>


</body>
</html>
